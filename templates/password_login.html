<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>密码登录</title>
	<link href="/static/css/layui.css" rel="stylesheet">
</head>
<body>
	<ul class="layui-nav">
		<li class="layui-nav-item">
			<img alt="50x50" src="/static/img/logo-big-w.png" width=100% height=30pt />
		</li>
		<li class="layui-nav-item">
			<a href="">您好，请登录</a>
		</li>
	</ul>

	<div id='content' style="padding: 10pt 550px 10pt 550px;">
		<h1 style="text-align: center; padding: 20pt;">密码登录</h1>
		
		<!-- 登录表单 -->
		<form id="login-form" class="layui-form" method="post">
			{% csrf_token %}
			
			<!-- 用户名登录 -->
			<div class="layui-form-item" style="padding: 10pt;">
				<label class="layui-form-label">用户名</label>
				<div class="layui-input-block">
					<input type="text" name="username" lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input" style="width: 50%;">
				</div>
			</div>
			<div class="layui-form-item" style="padding: 10pt;">
				<label class="layui-form-label">密码</label>
				<div class="layui-input-inline layui-input-wrap">
					<input type="password" name="password" lay-verify="required|pass" placeholder="请输入密码" autocomplete="off" class="layui-input">
				</div>
			</div>
			
			<!-- 提交按钮 -->
			<div class="layui-form-item" style="padding: 10pt;">
				<div class="layui-input-block">
					<button type="submit" class="layui-btn" lay-submit lay-filter="demo1">登录</button>
					<a href="/register" style="color: #16baaa; padding: 5px">立即注册</a>
				</div>
			</div>
		</form>
	</div>

	<script src="/static/js/layui.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	{% comment %} <script>
		$(document).ready(function() {
			$('#login-form').on('submit', function(e) {
				e.preventDefault(); // 阻止表单默认提交
			
				var formData = $(this).serialize(); // 序列化表单数据
			
				$.ajax({
					type: 'POST',
					url: '/login/password/',  // Django 处理登录的 URL
					data: formData,
					headers: {
						'X-CSRFToken': '{{ csrf_token }}'  // 使用传递的 CSRF 令牌
					},
					success: function(response) {
						if (response.status === 'success') {
							alert(response.message);  // 显示登录成功的消息
							window.location.href = response.redirect_url;  // 成功后跳转到重定向 URL
						} else {
							alert('登录失败：' + response.message);  // 显示错误消息
						}
					},
					error: function() {
						alert('请求失败，请稍后重试。');
					}
				});
			});
		});
	</script> {% endcomment %}
	<script>
	$(document).ready(function() {
		$('#login-form').on('submit', function(e) {
			e.preventDefault(); // 阻止表单默认提交
	
			var formData = $(this).serialize(); // 序列化表单数据
	
			$.ajax({
				type: 'POST',
				url: '/login/password/', // Django 登录 URL（对于人脸登录改成对应的URL）
				data: formData,
				headers: {
					'X-CSRFToken': '{{ csrf_token }}' // 使用传递的 CSRF 令牌
				},
				success: function(response) {
					if (response.status === 'success') {
						alert('登录成功！即将跳转...');
						setTimeout(function() {
							window.location.href = response.redirect_url; // 3秒后跳转
						}, 3000); // 延迟3秒 (3000毫秒)
					} else {
						alert('登录失败：' + response.message);
					}
				},
				error: function() {
					alert('请求失败，请稍后重试。');
				}
			});
		});
	});	
	</script>
</body>
</html>
